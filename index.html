<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soundify - Halloween Edition 🎃</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico"><!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script><!-- Google Sign-In -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0a00 0%, #000000 50%, #2d1810 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1a0a00 0%, #121212 100%);
            border-right: 1px solid #ff6b35;
            display: flex;
            flex-direction: column;
            padding: 24px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            padding: 8px 0;
        }
        
        .logo-image {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            transition: transform 0.2s ease;
        }
        
        .logo-image:hover {
            transform: scale(1.05);
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(255, 107, 53, 0.2);
        }
        
        .halloween-badge {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 107, 53, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 107, 53, 0.8); }
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
            border-left: 3px solid #ff6b35;
        }
        
        .nav-item.active {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.2), rgba(247, 147, 30, 0.2));
            border-left: 3px solid #ff6b35;
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            margin-right: 16px;
            fill: currentColor;
        }
        
        .create-playlist-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            margin: 16px 0;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        
        .create-playlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .playlist-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 16px;
        }
        
        .playlist-item {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.2s;
        }
        
        .playlist-item:hover {
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #2d1810 0%, #121212 300px);
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.1), rgba(0, 0, 0, 0.8));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
        }
        
        .nav-buttons {
            display: flex;
            gap: 16px;
        }
        
        .nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .online-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #b3b3b3;
            font-size: 14px;
            background: linear-gradient(45deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
            padding: 6px 12px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }
        
        .online-dot {
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .upgrade-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);
        }
        
        .upgrade-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            color: white;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0 32px 100px 32px;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #1e3a8a 100%);
            border-radius: 12px;
            padding: 48px;
            margin-bottom: 48px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '🎃';
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 60px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .hero-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 16px;
        }
        
        .hero-subtitle {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .section {
            margin-bottom: 48px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 24px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 24px;
        }
        
        .card {
            background: linear-gradient(135deg, #1a1a1a, #2d1810);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 107, 53, 0.1);
        }
        
        .card:hover {
            background: linear-gradient(135deg, #282828, #3d2820);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 24px rgba(255, 107, 53, 0.25);
            border: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .card.halloween-card {
            border: 2px solid #ff6b35;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3);
        }
        
        .card.halloween-card:hover {
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.5);
        }
        
        .card-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: relative;
            overflow: hidden;
        }
        
        .play-overlay {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 48px;
            height: 48px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(8px);
            transition: all 0.3s ease;
            cursor: pointer;
            color: white;
        }
        
        .card:hover .play-overlay {
            opacity: 1;
            transform: translateY(0);
        }
        
        .like-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #b3b3b3;
        }
        
        .like-btn:hover {
            background: rgba(255, 107, 53, 0.8);
            color: white;
            transform: scale(1.1);
        }
        
        .like-btn.liked {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
        }
        
        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .card-subtitle {
            color: #b3b3b3;
            font-size: 14px;
        }
        
        .halloween-emoji {
            margin-left: 8px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        
        .player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #1a1a1a, #2d1810);
            border-top: 2px solid #ff6b35;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -4px 20px rgba(255, 107, 53, 0.2);
        }
        
        .now-playing {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }
        
        .track-info {
            margin-left: 16px;
            min-width: 0;
        }
        
        .track-name {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .track-artist {
            color: #b3b3b3;
            font-size: 12px;
        }
        
        .player-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 600px;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: #b3b3b3;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            color: #ff6b35;
            transform: scale(1.1);
        }
        
        .control-btn.active {
            color: #ff6b35;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            width: 100%;
            gap: 12px;
        }
        
        .time {
            font-size: 12px;
            color: #b3b3b3;
            min-width: 40px;
        }
        
        .progress-bar {
            flex: 1;
            height: 4px;
            background-color: #535353;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }
        
        .volume-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            justify-content: flex-end;
        }
        
        .volume-bar {
            width: 100px;
            height: 4px;
            background-color: #535353;
            border-radius: 2px;
            cursor: pointer;
        }
        
        .volume-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 2px;
            width: 70%;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2d1810, #1a1a1a);
            padding: 32px;
            border-radius: 12px;
            width: 400px;
            max-width: 90vw;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 24px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #535353;
            border-radius: 8px;
            background-color: #121212;
            color: white;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: #b3b3b3;
            border: 1px solid #535353;
        }
        
        .btn-secondary:hover {
            color: white;
            border-color: #ff6b35;
        }
        
        .search-container {
            margin-bottom: 32px;
        }
        
        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 24px;
            background: linear-gradient(135deg, #242424, #2d1810);
            color: white;
            font-size: 16px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }
        
        .browse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }
        
        .category-card {
            aspect-ratio: 1;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: flex-end;
            position: relative;
            overflow: hidden;
        }
        
        .category-card:hover {
            transform: scale(1.05);
        }
        
        .category-title {
            font-size: 20px;
            font-weight: bold;
            z-index: 2;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #ff6b35;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.4);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #1e3a8a 100%);
        }
        
        .auth-card {
            background: linear-gradient(135deg, #1a1a1a, #2d1810);
            padding: 48px;
            border-radius: 12px;
            width: 400px;
            max-width: 90vw;
            border: 2px solid rgba(255, 107, 53, 0.3);
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.2);
        }
        
        .auth-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 32px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .auth-logo {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            animation: logoGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            from {
                box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            }
            to {
                box-shadow: 0 8px 25px rgba(255, 107, 53, 0.6);
            }
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 24px;
            color: #b3b3b3;
        }
        
        .auth-link {
            color: #ff6b35;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .auth-link:hover {
            color: #f7931e;
        }
        
        .update-log {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 350px;
            max-height: 500px;
            background: linear-gradient(135deg, #1a1a1a, #2d1810);
            border: 2px solid #ff6b35;
            border-radius: 12px;
            padding: 20px;
            z-index: 1000;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.3);
        }
        
        .update-log.show {
            transform: translateX(0);
        }
        
        .update-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .update-log-title {
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close-log-btn {
            background: none;
            border: none;
            color: #b3b3b3;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }
        
        .close-log-btn:hover {
            color: #ff6b35;
        }
        
        .log-entry {
            margin-bottom: 16px;
            padding: 12px;
            background: linear-gradient(135deg, #121212, #1a0a00);
            border-radius: 8px;
            border-left: 3px solid #ff6b35;
        }
        
        .log-entry.removed {
            border-left-color: #ff6b6b;
        }
        
        .log-entry.updated {
            border-left-color: #ffa500;
        }
        
        .log-date {
            font-size: 12px;
            color: #b3b3b3;
            margin-bottom: 8px;
        }
        
        .log-action {
            font-weight: 600;
            margin-bottom: 4px;
            color: #ff6b35;
        }
        
        .log-entry.removed .log-action {
            color: #ff6b6b;
        }
        
        .log-entry.updated .log-action {
            color: #ffa500;
        }
        
        .log-description {
            font-size: 14px;
            color: #e0e0e0;
            line-height: 1.4;
        }
        
        .watermark {
            text-align: center;
            padding: 12px;
            margin-top: 16px;
            border-top: 1px solid rgba(255, 107, 53, 0.3);
            font-size: 12px;
            color: #535353;
        }
        
        .watermark .team-name {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .update-log-toggle {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .update-log-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        
        .feature-card {
            background: linear-gradient(135deg, #ff6b35, #f7931e, #1e3a8a);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .feature-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            color: white;
        }
        
        .feature-description {
            color: rgba(255,255,255,0.8);
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .feature-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .feature-btn {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .feature-btn:hover {
            background-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1a1a1a, #2d1810);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 107, 53, 0.2);
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #b3b3b3;
            font-size: 14px;
        }
        
        .equalizer {
            display: flex;
            align-items: end;
            gap: 4px;
            height: 40px;
            margin: 0 12px;
        }
        
        .eq-bar {
            width: 4px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 2px;
            animation: bounce 1.5s ease-in-out infinite;
        }
        
        .eq-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
        .eq-bar:nth-child(2) { height: 35px; animation-delay: 0.1s; }
        .eq-bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
        .eq-bar:nth-child(4) { height: 40px; animation-delay: 0.3s; }
        .eq-bar:nth-child(5) { height: 15px; animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }
        
        .genre-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .genre-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 20px;
            background: transparent;
            color: #b3b3b3;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .genre-btn:hover, .genre-btn.active {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border-color: transparent;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
                overflow-y: auto;
                border-right: none;
                border-bottom: 2px solid #ff6b35;
                padding: 16px;
                position: relative;
                z-index: 10;
            }
            
            .sidebar .logo {
                margin-bottom: 16px;
            }
            
            .sidebar nav {
                display: flex;
                gap: 8px;
                overflow-x: auto;
                padding-bottom: 8px;
            }
            
            .nav-item {
                white-space: nowrap;
                min-width: auto;
                padding: 8px 16px;
                margin-bottom: 0;
            }
            
            .create-playlist-btn {
                display: none;
            }
            
            .playlist-list {
                display: none;
            }
            
            .main-content {
                flex: 1;
                min-height: 0;
            }
            
            .top-bar {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .user-menu {
                gap: 8px;
            }
            
            .online-counter {
                font-size: 12px;
                padding: 4px 8px;
            }
            
            .upgrade-btn {
                padding: 6px 16px;
                font-size: 14px;
            }
            
            .content-area {
                padding: 0 16px 120px 16px;
            }
            
            .hero-section {
                padding: 24px;
                margin-bottom: 24px;
            }
            
            .hero-title {
                font-size: 28px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 12px;
            }
            
            .browse-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 16px;
            }
            
            .player-bar {
                flex-direction: column;
                gap: 12px;
                padding: 12px 16px;
                height: auto;
            }
            
            .now-playing {
                order: 1;
                justify-content: center;
            }
            
            .player-controls {
                order: 2;
                max-width: 100%;
            }
            
            .volume-controls {
                order: 3;
                justify-content: center;
            }
            
            .control-buttons {
                gap: 20px;
                margin-bottom: 8px;
            }
            
            .progress-container {
                gap: 8px;
            }
            
            .time {
                min-width: 35px;
                font-size: 11px;
            }
            
            .modal-content {
                width: 90vw;
                padding: 24px;
                margin: 16px;
            }
            
            .auth-card {
                width: 90vw;
                padding: 32px 24px;
            }
            
            .auth-title {
                font-size: 24px;
            }
            
            .feature-card {
                padding: 20px;
            }
            
            .feature-title {
                font-size: 18px;
            }
            
            .feature-actions {
                gap: 8px;
            }
            
            .feature-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .stat-card {
                padding: 16px;
            }
            
            .stat-number {
                font-size: 24px;
            }
            
            .update-log {
                width: 90vw;
                right: 5vw;
                max-height: 70vh;
            }
            
            .update-log-toggle {
                right: 16px;
                top: 16px;
                font-size: 11px;
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .browse-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .section-title {
                font-size: 20px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Authentication Screen -->
  <div id="auth-screen" class="auth-container">
   <div class="auth-card">
    <h1 id="auth-title" class="auth-title"><img src="logo.png" alt="Soundify Logo" class="auth-logo" onerror="this.style.display='none';"> <span>Soundify</span> <span class="halloween-badge">🎃 Halloween</span></h1>
    <form id="auth-form">
     <div class="form-group"><label class="form-label">Email</label> <input type="email" id="auth-email" class="form-input" required>
     </div>
     <div class="form-group"><label class="form-label">Password</label> <input type="password" id="auth-password" class="form-input" required>
     </div><button type="submit" id="auth-submit" class="btn btn-primary" style="width: 100%;"> Sign In </button>
    </form>
    <div style="text-align: center; margin: 24px 0; color: #535353;"><span>or</span>
    </div><button id="google-signin-btn" class="btn" style="width: 100%; background-color: white; color: black; display: flex; align-items: center; justify-content: center; gap: 12px;">
     <svg width="18" height="18" viewbox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /> <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /> <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
     </svg> Continue with Google </button>
    <div class="auth-toggle"><span id="auth-toggle-text">Don't have an account?</span> <span id="auth-toggle-link" class="auth-link">Sign up</span>
    </div>
   </div>
  </div><!-- Main App -->
  <div id="main-app" class="app-container hidden"><!-- Sidebar -->
   <div class="sidebar">
    <div id="app-logo" class="logo"><img src="logo.png" alt="Soundify Logo" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.marginLeft='0';"> <span class="logo-text">Soundify</span> <span class="halloween-badge">🎃 Halloween</span>
    </div>
    <nav>
     <div class="nav-item active" onclick="showView('home')">
      <svg class="nav-icon" viewbox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
      </svg> Home
     </div>
     <div class="nav-item" onclick="showView('search')">
      <svg class="nav-icon" viewbox="0 0 24 24"><circle cx="11" cy="11" r="8" /> <path d="m21 21-4.35-4.35" />
      </svg> Search
     </div>
     <div class="nav-item" onclick="showView('library')">
      <svg class="nav-icon" viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z" />
      </svg> Your Library
     </div>
     <div class="nav-item" onclick="showView('favorites')">
      <svg class="nav-icon" viewbox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
      </svg> Favorites ❤️
     </div>
    </nav><button class="create-playlist-btn" onclick="openCreatePlaylistModal()"> 🎃 Create Halloween Playlist </button>
    <div class="playlist-list" id="playlist-list"><!-- Playlists will be rendered here -->
    </div>
   </div><!-- Main Content -->
   <div class="main-content"><!-- Top Bar -->
    <div class="top-bar">
     <div class="nav-buttons"><button class="nav-btn">
       <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M15 18l-6-6 6-6" />
       </svg></button> <button class="nav-btn">
       <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M9 18l6-6-6-6" />
       </svg></button>
     </div>
     <div class="user-menu"><button class="update-log-toggle" onclick="toggleUpdateLog()"> 🎃 Halloween Updates </button>
      <div class="online-counter">
       <div class="online-dot"></div><span id="online-count">42</span> online
      </div><button class="upgrade-btn" onclick="openUpgradeModal()"> <span id="upgrade-text">Upgrade</span> </button>
      <div class="user-avatar" onclick="openProfileModal()"><span id="user-initial">U</span>
      </div>
     </div>
    </div><!-- Update Log Panel -->
    <div id="update-log" class="update-log">
     <div class="update-log-header">
      <div class="update-log-title">
       🎃 Halloween Update Log
      </div><button class="close-log-btn" onclick="toggleUpdateLog()">
       <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M18 6L6 18M6 6l12 12" />
       </svg></button>
     </div>
     <div id="log-entries"><!-- Log entries will be populated here -->
     </div>
     <div class="watermark">
      Made with ❤️ by <span class="team-name">Vesni &amp; Forca Team</span><br><small>🎃 Halloween Special Edition 2024</small>
     </div>
    </div><!-- Content Area -->
    <div class="content-area"><!-- Home View -->
     <div id="home-view">
      <div class="hero-section">
       <h1 id="welcome-title" class="hero-title">🎃 Happy Halloween!</h1>
       <p class="hero-subtitle">Get ready for a spooky music experience with 50+ tracks!</p>
      </div><!-- Genre Filter -->
      <div class="genre-filter"><button class="genre-btn active" onclick="filterByGenre('all')">All Music</button> <button class="genre-btn" onclick="filterByGenre('Halloween')">🎃 Halloween</button> <button class="genre-btn" onclick="filterByGenre('Pop')">🎵 Pop</button> <button class="genre-btn" onclick="filterByGenre('Rock')">🎸 Rock</button> <button class="genre-btn" onclick="filterByGenre('Hip-Hop')">🎤 Hip-Hop</button> <button class="genre-btn" onclick="filterByGenre('Electronic')">🎹 Electronic</button>
      </div>
      <div class="section">
       <h2 class="section-title">🎃 Halloween Specials</h2>
       <div class="grid" id="halloween-grid"><!-- Halloween tracks will be rendered here -->
       </div>
      </div>
      <div class="section">
       <h2 class="section-title">🔥 Trending Now</h2>
       <div class="grid" id="trending-grid"><!-- Trending tracks will be rendered here -->
       </div>
      </div>
      <div class="section">
       <h2 class="section-title">🎵 All Music</h2>
       <div class="grid" id="all-music-grid"><!-- All tracks will be rendered here -->
       </div>
      </div><!-- Stats Section -->
      <div class="section">
       <h2 class="section-title">📊 Your Halloween Stats</h2>
       <div class="stats-grid">
        <div class="stat-card">
         <div class="stat-number" id="total-tracks">
          50
         </div>
         <div class="stat-label">
          Total Tracks
         </div>
        </div>
        <div class="stat-card">
         <div class="stat-number" id="total-playlists">
          0
         </div>
         <div class="stat-label">
          Playlists
         </div>
        </div>
        <div class="stat-card">
         <div class="stat-number" id="liked-count">
          0
         </div>
         <div class="stat-label">
          Liked Songs
         </div>
        </div>
        <div class="stat-card">
         <div class="stat-number" id="listening-time">
          0h
         </div>
         <div class="stat-label">
          Listening Time
         </div>
        </div>
       </div>
      </div>
     </div><!-- Search View -->
     <div id="search-view" class="hidden">
      <div class="search-container"><input type="text" class="search-input" placeholder="Search for Halloween songs, artists, or genres..." oninput="performSearch(this.value)">
      </div>
      <div id="search-results" class="hidden">
       <h2 class="section-title">Search Results</h2>
       <div id="search-content"></div>
      </div>
      <div id="browse-section">
       <h2 class="section-title">Browse all</h2>
       <div class="browse-grid">
        <div class="category-card" style="background: linear-gradient(135deg, #ff6b35, #f7931e);" onclick="filterByGenre('Halloween')">
         <div class="category-title">
          🎃 Halloween
         </div>
        </div>
        <div class="category-card" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);" onclick="filterByGenre('Pop')">
         <div class="category-title">
          🎵 Pop
         </div>
        </div>
        <div class="category-card" style="background: linear-gradient(135deg, #4834d4, #686de0);" onclick="filterByGenre('Rock')">
         <div class="category-title">
          🎸 Rock
         </div>
        </div>
        <div class="category-card" style="background: linear-gradient(135deg, #00d2d3, #54a0ff);" onclick="filterByGenre('Hip-Hop')">
         <div class="category-title">
          🎤 Hip-Hop
         </div>
        </div>
        <div class="category-card" style="background: linear-gradient(135deg, #ff9ff3, #f368e0);" onclick="filterByGenre('Electronic')">
         <div class="category-title">
          🎹 Electronic
         </div>
        </div>
       </div>
      </div>
     </div><!-- Library View -->
     <div id="library-view" class="hidden">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
       <h2 class="section-title" style="margin-bottom: 0;">Your Library</h2><button class="btn btn-primary" onclick="openCreatePlaylistModal()"> 🎃 Create Playlist </button>
      </div>
      <div id="library-content"><!-- Library content will be rendered here -->
      </div>
     </div><!-- Favorites View -->
     <div id="favorites-view" class="hidden">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
       <h2 class="section-title" style="margin-bottom: 0;">❤️ Your Favorite Songs</h2><button class="btn btn-secondary" onclick="clearAllLikes()"> Clear All Likes </button>
      </div>
      <div id="favorites-content"><!-- Favorites content will be rendered here -->
      </div>
     </div>
    </div>
   </div>
  </div><!-- Hidden YouTube Player -->
  <div id="youtube-player" style="position: absolute; top: -9999px; left: -9999px;"></div><!-- Player Bar -->
  <div id="player-bar" class="player-bar hidden">
   <div class="now-playing">
    <div id="current-track-image" class="card-image" style="width: 56px; height: 56px; margin-bottom: 0; background: linear-gradient(135deg, #ff6b35, #f7931e);">
     🎵
    </div>
    <div class="track-info">
     <div id="current-track-name" class="track-name">
      Select a song
     </div>
     <div id="current-track-artist" class="track-artist">
      No artist
     </div>
    </div>
   </div>
   <div class="player-controls">
    <div class="control-buttons"><button class="control-btn" onclick="toggleShuffle()" id="shuffle-btn">
      <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M14.83 13.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13zM14.5 4l2.04 2.04L13.41 9.17l1.41 1.41 3.13-3.13L20 9.5V4h-5.5zM6 13c0-1.65 1.35-3 3-3s3 1.35 3 3-1.35 3-3 3-3-1.35-3-3zM3 7l2.04 2.04L8.17 5.91 9.58 7.32 6.45 10.45 4.41 8.41 3 7z" />
      </svg></button> <button class="control-btn" onclick="previousTrack()">
      <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M6 4l10 8-10 8V4z" /> <path d="M6 4l10 8-10 8V4z" transform="translate(-4,0)" />
      </svg></button> <button id="play-pause-btn" class="control-btn play-btn" onclick="togglePlayPause()">
      <svg id="play-icon" width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z" />
      </svg>
      <svg id="pause-icon" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="display: none;"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" />
      </svg></button> <button class="control-btn" onclick="nextTrack()">
      <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M18 4l-10 8 10 8V4z" /> <path d="M18 4l-10 8 10 8V4z" transform="translate(4,0)" />
      </svg></button> <button class="control-btn" onclick="toggleLoop()" id="loop-btn">
      <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z" />
      </svg></button> <!-- Animated Equalizer -->
     <div class="equalizer" id="equalizer" style="display: none;">
      <div class="eq-bar"></div>
      <div class="eq-bar"></div>
      <div class="eq-bar"></div>
      <div class="eq-bar"></div>
      <div class="eq-bar"></div>
     </div>
    </div>
    <div class="progress-container"><span id="current-time" class="time">0:00</span>
     <div class="progress-bar" onclick="seekTo(event)">
      <div id="progress-fill" class="progress-fill"></div>
     </div><span id="total-time" class="time">0:00</span>
    </div>
   </div>
   <div class="volume-controls"><button class="control-btn">
     <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"><path d="M11 5L6 9H2v6h4l5 4V5z" /> <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" />
     </svg></button>
    <div class="volume-bar">
     <div class="volume-fill"></div>
    </div>
   </div>
  </div><!-- Create Playlist Modal -->
  <div id="playlist-modal" class="modal hidden">
   <div class="modal-content">
    <h3 class="modal-title">🎃 Create Halloween Playlist</h3>
    <form id="playlist-form">
     <div class="form-group"><label class="form-label">Playlist Name</label> <input type="text" id="playlist-name" class="form-input" placeholder="My Spooky Playlist" required>
     </div>
     <div class="form-group"><label class="form-label">Description (Optional)</label> <input type="text" id="playlist-description" class="form-input" placeholder="Perfect for Halloween night...">
     </div>
     <div class="form-group"><label class="form-label">Privacy</label> <select id="playlist-privacy" class="form-input"> <option value="private">🔒 Private - Only you can see this</option> <option value="public">🌍 Public - Everyone can see this</option> </select>
     </div>
     <div class="button-group"><button type="button" class="btn btn-secondary" onclick="closeCreatePlaylistModal()"> Cancel </button> <button type="submit" class="btn btn-primary"> Create </button>
     </div>
    </form>
   </div>
  </div><!-- Profile Modal -->
  <div id="profile-modal" class="modal hidden">
   <div class="modal-content">
    <h3 class="modal-title">🎃 Profile Settings</h3>
    <form id="profile-form">
     <div class="form-group"><label class="form-label">Display Name</label> <input type="text" id="profile-name" class="form-input" placeholder="Your Name">
     </div>
     <div class="form-group"><label class="form-label">Bio</label> <textarea id="profile-bio" class="form-input" placeholder="Tell us about your Halloween music taste..." rows="3"></textarea>
     </div>
     <div class="form-group"><label class="form-label">Favorite Genre</label> <select id="profile-genre" class="form-input"> <option value="Halloween">🎃 Halloween</option> <option value="Electronic">🎹 Electronic</option> <option value="Pop">🎵 Pop</option> <option value="Rock">🎸 Rock</option> <option value="Hip-Hop">🎤 Hip-Hop</option> <option value="Jazz">🎺 Jazz</option> <option value="Classical">🎼 Classical</option> </select>
     </div>
     <div class="form-group">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: linear-gradient(135deg, #1a1a1a, #2d1810); border-radius: 8px; margin-bottom: 16px; border: 1px solid rgba(255, 107, 53, 0.2);">
       <div>
        <div style="font-weight: 600; color: #ff6b35;">
         Account Status
        </div>
        <div style="color: #b3b3b3; font-size: 14px;" id="account-status">
         Free Plan - 4 hours daily limit
        </div>
       </div>
       <div style="color: #ff6b35; font-weight: bold;" id="usage-time">
        0h used today
       </div>
      </div>
     </div>
     <div class="button-group"><button type="button" class="btn btn-secondary" onclick="closeProfileModal()"> Cancel </button> <button type="button" class="btn" style="background-color: #ff4757; color: white;" onclick="signOut()"> Sign Out </button> <button type="submit" class="btn btn-primary"> Save Changes </button>
     </div>
    </form>
   </div>
  </div><!-- Upgrade Modal -->
  <div id="upgrade-modal" class="modal hidden">
   <div class="modal-content" style="max-width: 420px;">
    <h3 class="modal-title">🎃 Upgrade to Halloween Premium</h3>
    <div style="background: linear-gradient(135deg, #ff6b35, #f7931e); padding: 16px; border-radius: 8px; margin-bottom: 16px; text-align: center;">
     <h2 style="margin: 0 0 4px 0; font-size: 20px;">Soundify Halloween Premium</h2>
     <p style="margin: 0; opacity: 0.9; font-size: 14px;">Unlimited spooky music, unlimited possibilities</p>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
     <div style="padding: 12px; background: linear-gradient(135deg, #1a1a1a, #2d1810); border-radius: 6px; border: 1px solid rgba(255, 107, 53, 0.2);">
      <h4 style="color: #b3b3b3; margin: 0 0 8px 0; font-size: 14px;">Free Plan</h4>
      <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
       $0<span style="font-size: 12px; color: #b3b3b3;">/month</span>
      </div>
      <ul style="list-style: none; padding: 0; margin: 0; font-size: 12px;">
       <li style="margin-bottom: 4px; color: #b3b3b3;">⏰ 4 hours daily</li>
       <li style="margin-bottom: 4px; color: #b3b3b3;">📱 Basic features</li>
       <li style="margin-bottom: 4px; color: #b3b3b3;">🎵 10 playlists max</li>
      </ul>
     </div>
     <div style="padding: 12px; background: linear-gradient(135deg, #1a1a1a, #2d1810); border-radius: 6px; border: 2px solid #ff6b35;">
      <h4 style="color: #ff6b35; margin: 0 0 8px 0; font-size: 14px;">Premium Plan</h4>
      <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
       $9.99<span style="font-size: 12px; color: #b3b3b3;">/month</span>
      </div>
      <ul style="list-style: none; padding: 0; margin: 0; font-size: 12px;">
       <li style="margin-bottom: 4px; color: #ff6b35;">⏰ Unlimited listening</li>
       <li style="margin-bottom: 4px; color: #ff6b35;">🎵 Unlimited playlists</li>
       <li style="margin-bottom: 4px; color: #ff6b35;">🎃 Halloween themes</li>
       <li style="margin-bottom: 4px; color: #ff6b35;">🔊 High-quality audio</li>
      </ul>
     </div>
    </div>
    <div id="admin-upgrade-section" class="hidden" style="background-color: #ff4757; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
     <h4 style="margin: 0 0 8px 0; color: white; font-size: 14px;">🔐 Admin Controls</h4>
     <div style="margin-bottom: 8px;"><input type="email" id="grant-email" placeholder="Enter user email" style="width: 100%; padding: 6px 8px; border: none; border-radius: 4px; font-size: 12px; margin-bottom: 6px;">
     </div>
     <div style="display: flex; gap: 8px;"><button class="btn" style="background-color: white; color: #ff4757; padding: 6px 12px; font-size: 12px;" onclick="grantPremiumByEmail()"> Grant Premium </button> <button class="btn" style="background-color: rgba(255,255,255,0.2); color: white; padding: 6px 12px; font-size: 12px;" onclick="revokePremiumByEmail()"> Revoke Premium </button>
     </div>
    </div>
    <div class="button-group"><button type="button" class="btn btn-secondary" onclick="closeUpgradeModal()"> Maybe Later </button> <button type="button" class="btn btn-primary" onclick="upgradeToPremium()" id="upgrade-action-btn"> Upgrade Now </button>
    </div>
   </div>
  </div>
  <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAPei3-puz3fsbrhk0s6l6rZGd30Mly2kk",
            authDomain: "soundify-67929.firebaseapp.com",
            projectId: "soundify-67929",
            storageBucket: "soundify-67929.firebasestorage.app",
            messagingSenderId: "278902873913",
            appId: "1:278902873913:web:a198391fee0ea00d78d2e8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.addScope('email');
        googleProvider.addScope('profile');

        // Configuration
        const defaultConfig = {
            app_name: "Soundify",
            welcome_message: "🎃 Happy Halloween!"
        };

        // 🎃 HALLOWEEN MUSIC COLLECTION - 50+ Real YouTube Tracks! 🎃
        const sampleTracks = [
            // 🎃 Halloween Classics
            { 
                id: '1', 
                title: 'Thriller', 
                artist: 'Michael Jackson', 
                album: 'Thriller', 
                duration: '5:57', 
                genre: 'Halloween',
                youtubeId: 'sOnqjkJTMaA',
                isHalloween: true
            },
            { 
                id: '2', 
                title: 'Ghostbusters', 
                artist: 'Ray Parker Jr.', 
                album: 'Ghostbusters Soundtrack', 
                duration: '4:05', 
                genre: 'Halloween',
                youtubeId: 'Fe93CLbHjxQ',
                isHalloween: true
            },
            { 
                id: '3', 
                title: 'Monster Mash', 
                artist: 'Bobby Pickett', 
                album: 'The Original Monster Mash', 
                duration: '3:12', 
                genre: 'Halloween',
                youtubeId: 'AxcM3nCsglA',
                isHalloween: true
            },
            { 
                id: '4', 
                title: 'Somebody\'s Watching Me', 
                artist: 'Rockwell', 
                album: 'Somebody\'s Watching Me', 
                duration: '3:59', 
                genre: 'Halloween',
                youtubeId: '7YvAYIJSSZY',
                isHalloween: true
            },
            { 
                id: '5', 
                title: 'This Is Halloween', 
                artist: 'The Nightmare Before Christmas', 
                album: 'Nightmare Before Christmas Soundtrack', 
                duration: '3:16', 
                genre: 'Halloween',
                youtubeId: 'qzt7JvsYIuI',
                isHalloween: true
            },
            
            // 🎵 Top Pop Hits
            { 
                id: '6', 
                title: 'Blinding Lights', 
                artist: 'The Weeknd', 
                album: 'After Hours', 
                duration: '3:20', 
                genre: 'Pop',
                youtubeId: '4NRXx6U8ABQ'
            },
            { 
                id: '7', 
                title: 'Shape of You', 
                artist: 'Ed Sheeran', 
                album: '÷ (Divide)', 
                duration: '3:53', 
                genre: 'Pop',
                youtubeId: 'JGwWNGJdvx8'
            },
            { 
                id: '8', 
                title: 'Bad Guy', 
                artist: 'Billie Eilish', 
                album: 'When We All Fall Asleep', 
                duration: '3:14', 
                genre: 'Pop',
                youtubeId: 'DyDfgMOUjCI'
            },
            { 
                id: '9', 
                title: 'Levitating', 
                artist: 'Dua Lipa', 
                album: 'Future Nostalgia', 
                duration: '3:23', 
                genre: 'Pop',
                youtubeId: 'TUVcZfQe-Kw'
            },
            { 
                id: '10', 
                title: 'Watermelon Sugar', 
                artist: 'Harry Styles', 
                album: 'Fine Line', 
                duration: '2:54', 
                genre: 'Pop',
                youtubeId: 'E07s5ZYygMg'
            },
            { 
                id: '11', 
                title: 'Anti-Hero', 
                artist: 'Taylor Swift', 
                album: 'Midnights', 
                duration: '3:20', 
                genre: 'Pop',
                youtubeId: 'b1kbLWvqugk'
            },
            { 
                id: '12', 
                title: 'As It Was', 
                artist: 'Harry Styles', 
                album: 'Harry\'s House', 
                duration: '2:47', 
                genre: 'Pop',
                youtubeId: 'H5v3kku4y6Q'
            },
            
            // 🎸 Rock Legends
            { 
                id: '13', 
                title: 'Bohemian Rhapsody', 
                artist: 'Queen', 
                album: 'A Night at the Opera', 
                duration: '5:55', 
                genre: 'Rock',
                youtubeId: 'fJ9rUzIMcZQ'
            },
            { 
                id: '14', 
                title: 'Don\'t Stop Believin\'', 
                artist: 'Journey', 
                album: 'Escape', 
                duration: '4:11', 
                genre: 'Rock',
                youtubeId: '1k8craCGpgs'
            },
            { 
                id: '15', 
                title: 'Sweet Child O\' Mine', 
                artist: 'Guns N\' Roses', 
                album: 'Appetite for Destruction', 
                duration: '5:03', 
                genre: 'Rock',
                youtubeId: '1w7OgIMMRc4'
            },
            { 
                id: '16', 
                title: 'Livin\' on a Prayer', 
                artist: 'Bon Jovi', 
                album: 'Slippery When Wet', 
                duration: '4:09', 
                genre: 'Rock',
                youtubeId: 'lDK9QqIzhwk'
            },
            { 
                id: '17', 
                title: 'We Will Rock You', 
                artist: 'Queen', 
                album: 'News of the World', 
                duration: '2:02', 
                genre: 'Rock',
                youtubeId: '-tJYN-eG1zk'
            },
            
            // 🎤 Hip-Hop Bangers
            { 
                id: '18', 
                title: 'Sunflower', 
                artist: 'Post Malone & Swae Lee', 
                album: 'Spider-Verse Soundtrack', 
                duration: '2:38', 
                genre: 'Hip-Hop',
                youtubeId: 'ApXoWvfEYVU'
            },
            { 
                id: '19', 
                title: 'God\'s Plan', 
                artist: 'Drake', 
                album: 'Scorpion', 
                duration: '3:19', 
                genre: 'Hip-Hop',
                youtubeId: 'xpVfcZ0ZcFM'
            },
            { 
                id: '20', 
                title: 'HUMBLE.', 
                artist: 'Kendrick Lamar', 
                album: 'DAMN.', 
                duration: '2:57', 
                genre: 'Hip-Hop',
                youtubeId: 'tvTRZJ-4EyI'
            },
            { 
                id: '21', 
                title: 'Sicko Mode', 
                artist: 'Travis Scott', 
                album: 'ASTROWORLD', 
                duration: '5:12', 
                genre: 'Hip-Hop',
                youtubeId: '6ONRf7h3Mdk'
            },
            { 
                id: '22', 
                title: 'Old Town Road', 
                artist: 'Lil Nas X', 
                album: '7 EP', 
                duration: '2:37', 
                genre: 'Hip-Hop',
                youtubeId: 'r7qovpFAGrQ'
            },
            
            // 🎹 Electronic/EDM
            { 
                id: '23', 
                title: 'Titanium', 
                artist: 'David Guetta ft. Sia', 
                album: 'Nothing but the Beat', 
                duration: '4:05', 
                genre: 'Electronic',
                youtubeId: 'JRfuAukYTKg'
            },
            { 
                id: '24', 
                title: 'Wake Me Up', 
                artist: 'Avicii', 
                album: 'True', 
                duration: '4:07', 
                genre: 'Electronic',
                youtubeId: 'IcrbM1l_BoI'
            },
            { 
                id: '25', 
                title: 'Clarity', 
                artist: 'Zedd ft. Foxes', 
                album: 'Clarity', 
                duration: '4:31', 
                genre: 'Electronic',
                youtubeId: 'IxxstCcJlsc'
            },
            { 
                id: '26', 
                title: 'Animals', 
                artist: 'Martin Garrix', 
                album: 'Animals', 
                duration: '5:05', 
                genre: 'Electronic',
                youtubeId: 'gCYcHz2k5x0'
            },
            { 
                id: '27', 
                title: 'Lean On', 
                artist: 'Major Lazer & DJ Snake', 
                album: 'Peace Is The Mission', 
                duration: '2:56', 
                genre: 'Electronic',
                youtubeId: 'YqeW9_5kURI'
            },
            
            // 💔 Emotional Ballads
            { 
                id: '28', 
                title: 'Someone You Loved', 
                artist: 'Lewis Capaldi', 
                album: 'Divinely Uninspired', 
                duration: '3:02', 
                genre: 'Pop',
                youtubeId: 'zABLecsR5UE'
            },
            { 
                id: '29', 
                title: 'Perfect', 
                artist: 'Ed Sheeran', 
                album: '÷ (Divide)', 
                duration: '4:23', 
                genre: 'Pop',
                youtubeId: '2Vv-BfVoq4g'
            },
            { 
                id: '30', 
                title: 'All of Me', 
                artist: 'John Legend', 
                album: 'Love in the Future', 
                duration: '4:29', 
                genre: 'Pop',
                youtubeId: '450p7goxZqg'
            },
            { 
                id: '31', 
                title: 'Stay', 
                artist: 'The Kid LAROI & Justin Bieber', 
                album: 'F*CK LOVE 3', 
                duration: '2:21', 
                genre: 'Pop',
                youtubeId: 'kTJczUoc26U'
            },
            { 
                id: '32', 
                title: 'Drivers License', 
                artist: 'Olivia Rodrigo', 
                album: 'SOUR', 
                duration: '4:02', 
                genre: 'Pop',
                youtubeId: 'ZmDBbnmKpqQ'
            },
            
            // 🔥 Recent Hits
            { 
                id: '33', 
                title: 'Flowers', 
                artist: 'Miley Cyrus', 
                album: 'Endless Summer Vacation', 
                duration: '3:20', 
                genre: 'Pop',
                youtubeId: 'G7KNmW9a75Y'
            },
            { 
                id: '34', 
                title: 'Unholy', 
                artist: 'Sam Smith ft. Kim Petras', 
                album: 'Gloria', 
                duration: '2:36', 
                genre: 'Pop',
                youtubeId: 'Uq9gPaIzbe8'
            },
            { 
                id: '35', 
                title: 'Heat Waves', 
                artist: 'Glass Animals', 
                album: 'Dreamland', 
                duration: '3:58', 
                genre: 'Indie',
                youtubeId: 'mRD0-GxqHVo'
            },
            { 
                id: '36', 
                title: 'Industry Baby', 
                artist: 'Lil Nas X & Jack Harlow', 
                album: 'MONTERO', 
                duration: '3:32', 
                genre: 'Hip-Hop',
                youtubeId: '5XeY7Fe7htI'
            },
            { 
                id: '37', 
                title: 'Good 4 U', 
                artist: 'Olivia Rodrigo', 
                album: 'SOUR', 
                duration: '2:58', 
                genre: 'Pop',
                youtubeId: 'gNi_6U5Pm_o'
            },
            
            // 🎵 Classic Hits
            { 
                id: '38', 
                title: 'Billie Jean', 
                artist: 'Michael Jackson', 
                album: 'Thriller', 
                duration: '4:54', 
                genre: 'Pop',
                youtubeId: 'Zi_XLOBDo_Y'
            },
            { 
                id: '39', 
                title: 'Hotel California', 
                artist: 'Eagles', 
                album: 'Hotel California', 
                duration: '6:30', 
                genre: 'Rock',
                youtubeId: '09839DpTctU'
            },
            { 
                id: '40', 
                title: 'Imagine', 
                artist: 'John Lennon', 
                album: 'Imagine', 
                duration: '3:07', 
                genre: 'Rock',
                youtubeId: 'YkgkThdzX-8'
            },
            { 
                id: '41', 
                title: 'Smells Like Teen Spirit', 
                artist: 'Nirvana', 
                album: 'Nevermind', 
                duration: '5:01', 
                genre: 'Rock',
                youtubeId: 'hTWKbfoikeg'
            },
            { 
                id: '42', 
                title: 'Like a Rolling Stone', 
                artist: 'Bob Dylan', 
                album: 'Highway 61 Revisited', 
                duration: '6:13', 
                genre: 'Rock',
                youtubeId: 'IwOfCgkyEj0'
            },
            
            // 🌟 More Recent Favorites
            { 
                id: '43', 
                title: 'Peaches', 
                artist: 'Justin Bieber ft. Daniel Caesar', 
                album: 'Justice', 
                duration: '3:18', 
                genre: 'Pop',
                youtubeId: 'tQ0yjYUFKAE'
            },
            { 
                id: '44', 
                title: 'Montero (Call Me By Your Name)', 
                artist: 'Lil Nas X', 
                album: 'MONTERO', 
                duration: '2:17', 
                genre: 'Hip-Hop',
                youtubeId: '6swmTBVI83k'
            },
            { 
                id: '45', 
                title: 'Deja Vu', 
                artist: 'Olivia Rodrigo', 
                album: 'SOUR', 
                duration: '3:35', 
                genre: 'Pop',
                youtubeId: '_C_3ZC0D-3M'
            },
            { 
                id: '46', 
                title: 'Levitating (Remix)', 
                artist: 'Dua Lipa ft. DaBaby', 
                album: 'Future Nostalgia', 
                duration: '3:23', 
                genre: 'Pop',
                youtubeId: 'WHuBW3qKm9g'
            },
            { 
                id: '47', 
                title: 'Positions', 
                artist: 'Ariana Grande', 
                album: 'Positions', 
                duration: '2:52', 
                genre: 'Pop',
                youtubeId: 'tcYodQoapMg'
            },
            
            // 🎃 More Halloween Spooks
            { 
                id: '48', 
                title: 'Superstition', 
                artist: 'Stevie Wonder', 
                album: 'Talking Book', 
                duration: '4:26', 
                genre: 'Halloween',
                youtubeId: '0CFuCYNx-1g',
                isHalloween: true
            },
            { 
                id: '49', 
                title: 'I Put a Spell on You', 
                artist: 'Bette Midler', 
                album: 'Hocus Pocus Soundtrack', 
                duration: '2:50', 
                genre: 'Halloween',
                youtubeId: 'ZcVkYD3Byms',
                isHalloween: true
            },
            { 
                id: '50', 
                title: 'Time Warp', 
                artist: 'Rocky Horror Picture Show', 
                album: 'Rocky Horror Soundtrack', 
                duration: '3:16', 
                genre: 'Halloween',
                youtubeId: 'umj0gu5nEGs',
                isHalloween: true
            }
        ];

        // App State
        let currentUser = null;
        let currentView = 'home';
        let isPlaying = false;
        let currentTrack = null;
        let currentTime = 0;
        let totalTime = 180;
        let playlists = [];
        let isAuthMode = true;
        let currentTrackIndex = 0;
        let listeningTime = 0;
        let updateLogVisible = false;
        let bassBoostEnabled = false;
        let voiceControlEnabled = false;
        let sleepTimer = null;
        let visualizerEnabled = false;
        let currentMoodFilter = 'all';
        let isLooping = false;
        let isShuffling = false;
        let likedTracks = [];
        let isHalloweenMode = true;
        let currentGenreFilter = 'all';
        
        // User Management
        let userProfile = {
            displayName: '',
            bio: '',
            favoriteGenre: 'Halloween',
            isPremium: false,
            dailyUsage: 0,
            lastUsageReset: new Date().toDateString()
        };
        
        // Admin users (only these emails can grant premium)
        const adminEmails = [
            'vesni277@gmail.com'
        ];
        
        // Usage tracking
        let usageStartTime = null;
        let usageInterval = null;
        
        // Local storage state
        let localStorageAvailable = true;
        
        // 🎃 Halloween Update Log System 🎃
        const updateLog = [
            {
                date: new Date().toLocaleDateString(),
                action: '🎃 HALLOWEEN UPDATE',
                type: 'added',
                description: '🎃 Halloween Music Collection - 50+ spooky tracks including Thriller, Ghostbusters, Monster Mash!'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '❤️ Like System - Heart your favorite tracks and build your personal collection'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🔄 Loop Mode - Repeat your current track or entire playlist endlessly'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🔀 Shuffle Mode - Randomize your music experience with smart shuffle'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🎵 Massive Music Library - 50+ real YouTube tracks across Pop, Rock, Hip-Hop, Electronic, Halloween'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🎨 Halloween Theme - Spooky orange accents and Halloween-themed UI elements'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '📱 Enhanced Track Cards - Like buttons, better animations, and improved hover effects'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🎯 Genre Filtering - Browse by Halloween, Pop, Rock, Hip-Hop, Electronic, and more'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '⭐ Favorites Collection - Access all your liked tracks in one convenient place'
            },
            {
                date: new Date().toLocaleDateString(),
                action: 'ADDED',
                type: 'added',
                description: '🎪 Auto-Play Features - Seamless transitions between tracks with loop and shuffle'
            }
        ];

        // Authentication Functions
        function toggleAuthMode() {
            isAuthMode = !isAuthMode;
            const submitBtn = document.getElementById('auth-submit');
            const toggleText = document.getElementById('auth-toggle-text');
            const toggleLink = document.getElementById('auth-toggle-link');
            
            if (isAuthMode) {
                submitBtn.textContent = 'Sign In';
                toggleText.textContent = "Don't have an account?";
                toggleLink.textContent = 'Sign up';
            } else {
                submitBtn.textContent = 'Sign Up';
                toggleText.textContent = 'Already have an account?';
                toggleLink.textContent = 'Sign in';
            }
        }

        async function handleAuth(event) {
            event.preventDefault();
            
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const submitBtn = document.getElementById('auth-submit');
            
            submitBtn.classList.add('loading');
            submitBtn.textContent = isAuthMode ? 'Signing In...' : 'Signing Up...';
            
            try {
                if (isAuthMode) {
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                }
            } catch (error) {
                showToast(error.message);
                submitBtn.classList.remove('loading');
                submitBtn.textContent = isAuthMode ? 'Sign In' : 'Sign Up';
            }
        }

        async function signInWithGoogle() {
            try {
                const result = await auth.signInWithPopup(googleProvider);
                const user = result.user;
                showToast(`🎃 Welcome ${user.displayName}! Happy Halloween!`);
                addUpdateLogEntry('SIGNED IN', 'updated', `🔐 User signed in with Google: ${user.displayName}`);
            } catch (error) {
                showToast('Google sign-in failed: ' + error.message);
                console.error('Google sign-in error:', error);
            }
        }

        async function signOut() {
            try {
                await auth.signOut();
                addUpdateLogEntry('SIGNED OUT', 'updated', '🔐 User signed out successfully');
            } catch (error) {
                showToast('Error signing out');
            }
        }

        // Auth State Observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('player-bar').classList.remove('hidden');
                
                // Set user initial
                const initial = user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
                document.getElementById('user-initial').textContent = initial;
                
                // Load user data and profile
                loadUserProfile();
                loadUserPlaylists();
                loadLikedTracks();
                renderHomeContent();
                updateUpgradeButton();
                updateUsageDisplay();
                
                // Check if user is admin
                if (adminEmails.includes(user.email)) {
                    showToast('👑 Admin access detected - Premium controls available');
                }
            } else {
                currentUser = null;
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('player-bar').classList.add('hidden');
                
                // Stop usage tracking on sign out
                stopUsageTracking();
            }
        });

        // Like System Functions
        function toggleLike(trackId) {
            const track = sampleTracks.find(t => t.id === trackId);
            if (!track) return;
            
            const isLiked = likedTracks.includes(trackId);
            
            if (isLiked) {
                likedTracks = likedTracks.filter(id => id !== trackId);
                showToast(`💔 Removed "${track.title}" from favorites`);
            } else {
                likedTracks.push(trackId);
                showToast(`❤️ Added "${track.title}" to favorites`);
            }
            
            saveLikedTracks();
            updateLikeButtons();
            updateStats();
            
            // Re-render favorites view if currently viewing
            if (currentView === 'favorites') {
                renderFavorites();
            }
        }
        
        function saveLikedTracks() {
            try {
                localStorage.setItem('soundify_liked_tracks', JSON.stringify(likedTracks));
            } catch (error) {
                console.error('Error saving liked tracks:', error);
            }
        }
        
        function loadLikedTracks() {
            try {
                const saved = localStorage.getItem('soundify_liked_tracks');
                if (saved) {
                    likedTracks = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Error loading liked tracks:', error);
                likedTracks = [];
            }
        }
        
        function updateLikeButtons() {
            document.querySelectorAll('.like-btn').forEach(btn => {
                const trackId = btn.dataset.trackId;
                const isLiked = likedTracks.includes(trackId);
                
                if (isLiked) {
                    btn.classList.add('liked');
                    btn.innerHTML = '❤️';
                } else {
                    btn.classList.remove('liked');
                    btn.innerHTML = '🤍';
                }
            });
        }
        
        function clearAllLikes() {
            if (likedTracks.length === 0) {
                showToast('No liked tracks to clear');
                return;
            }
            
            const count = likedTracks.length;
            likedTracks = [];
            saveLikedTracks();
            updateLikeButtons();
            updateStats();
            renderFavorites();
            showToast(`💔 Cleared ${count} liked tracks`);
        }
        
        // Loop and Shuffle Functions
        function toggleLoop() {
            isLooping = !isLooping;
            const loopBtn = document.getElementById('loop-btn');
            
            if (isLooping) {
                loopBtn.classList.add('active');
                showToast('🔄 Loop mode ON - Track will repeat');
            } else {
                loopBtn.classList.remove('active');
                showToast('🔄 Loop mode OFF');
            }
        }
        
        function toggleShuffle() {
            isShuffling = !isShuffling;
            const shuffleBtn = document.getElementById('shuffle-btn');
            
            if (isShuffling) {
                shuffleBtn.classList.add('active');
                showToast('🔀 Shuffle mode ON - Random track order');
            } else {
                shuffleBtn.classList.remove('active');
                showToast('🔀 Shuffle mode OFF - Normal track order');
            }
        }
        
        // Genre Filtering
        function filterByGenre(genre) {
            currentGenreFilter = genre;
            
            // Update active button
            document.querySelectorAll('.genre-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Re-render content based on filter
            renderHomeContent();
            
            if (genre === 'all') {
                showToast('🎵 Showing all music');
            } else {
                const count = sampleTracks.filter(track => track.genre === genre).length;
                showToast(`🎯 Filtered to ${genre} - ${count} tracks`);
            }
        }

        // Fallback data handler for local storage
        function savePlaylistsToLocal() {
            try {
                localStorage.setItem('soundify_playlists', JSON.stringify(playlists));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }
        
        function loadPlaylistsFromLocal() {
            try {
                const saved = localStorage.getItem('soundify_playlists');
                if (saved) {
                    playlists = JSON.parse(saved);
                    renderPlaylists();
                    renderLibrary();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                playlists = [];
            }
        }
        
        // Load playlists function
        async function loadUserPlaylists() {
            if (!currentUser) return;
            
            // First load from localStorage
            loadPlaylistsFromLocal();
            
            // Then try to sync with Firestore
            try {
                const snapshot = await db.collection('playlists')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const firestorePlaylists = snapshot.docs.map(doc => ({
                    id: doc.data().id || doc.id,
                    ...doc.data(),
                    tracks: doc.data().tracks ? JSON.parse(doc.data().tracks) : []
                }));
                
                // Merge with local playlists (Firestore takes priority for conflicts)
                const localIds = playlists.map(p => p.id);
                const newFromFirestore = firestorePlaylists.filter(p => !localIds.includes(p.id));
                
                if (newFromFirestore.length > 0) {
                    playlists = [...playlists, ...newFromFirestore];
                    savePlaylistsToLocal();
                    renderPlaylists();
                    renderLibrary();
                    updateStats();
                }
            } catch (error) {
                console.log('Firestore sync failed, using local storage only');
            }
        }

        async function createPlaylist(name, description = '', privacy = 'private') {
            if (!currentUser) return;
            
            // Check data limit (free users limited to 10 playlists)
            const maxPlaylists = userProfile.isPremium ? 50 : 10;
            if (playlists.length >= maxPlaylists) {
                showToast(`Maximum limit of ${maxPlaylists} playlists reached. ${!userProfile.isPremium ? 'Upgrade to Premium for more!' : 'Please delete some playlists first.'}`);
                return;
            }
            
            const playlistData = {
                id: Date.now().toString(),
                name: name,
                description: description,
                privacy: privacy,
                userId: currentUser.uid,
                tracks: [],
                createdAt: new Date().toISOString(),
                type: 'playlist'
            };
            
            try {
                // Add to local array
                playlists.push(playlistData);
                
                // Save to localStorage
                savePlaylistsToLocal();
                
                // Try to save to Firestore as backup
                try {
                    await db.collection('playlists').add({
                        ...playlistData,
                        tracks: JSON.stringify(playlistData.tracks),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (firestoreError) {
                    console.log('Firestore save failed, using local storage only');
                }
                
                renderPlaylists();
                renderLibrary();
                updateStats();
                showToast(`🎃 Playlist "${name}" created successfully!`);
            } catch (error) {
                showToast('Error creating playlist');
                console.error('Error creating playlist:', error);
            }
        }

        async function deletePlaylist(playlistId) {
            if (!currentUser) return;
            
            try {
                // Remove from local array
                playlists = playlists.filter(p => p.id !== playlistId);
                
                // Save to localStorage
                savePlaylistsToLocal();
                
                // Try to delete from Firestore as backup
                try {
                    const snapshot = await db.collection('playlists')
                        .where('userId', '==', currentUser.uid)
                        .where('id', '==', playlistId)
                        .get();
                    
                    snapshot.docs.forEach(doc => {
                        doc.ref.delete();
                    });
                } catch (firestoreError) {
                    console.log('Firestore delete failed, using local storage only');
                }
                
                renderPlaylists();
                renderLibrary();
                updateStats();
                showToast('🗑️ Playlist deleted successfully!');
            } catch (error) {
                showToast('Error deleting playlist');
                console.error('Error deleting playlist:', error);
            }
        }

        // UI Functions
        function showView(view) {
            // Hide all views
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('search-view').classList.add('hidden');
            document.getElementById('library-view').classList.add('hidden');
            document.getElementById('favorites-view').classList.add('hidden');
            
            // Show selected view
            document.getElementById(view + '-view').classList.remove('hidden');
            currentView = view;
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Render content based on view
            if (view === 'favorites') {
                renderFavorites();
            } else if (view === 'library') {
                renderLibrary();
            }
        }

        function renderHomeContent() {
            // Filter tracks based on current genre filter
            let tracksToShow = sampleTracks;
            if (currentGenreFilter !== 'all') {
                tracksToShow = sampleTracks.filter(track => track.genre === currentGenreFilter);
            }
            
            // Render Halloween tracks
            const halloweenGrid = document.getElementById('halloween-grid');
            halloweenGrid.innerHTML = '';
            
            const halloweenTracks = sampleTracks.filter(track => track.isHalloween);
            halloweenTracks.slice(0, 6).forEach((track, index) => {
                setTimeout(() => {
                    const card = createTrackCard(track, true);
                    card.classList.add('fade-in');
                    halloweenGrid.appendChild(card);
                }, index * 100);
            });
            
            // Render trending tracks
            const trendingGrid = document.getElementById('trending-grid');
            trendingGrid.innerHTML = '';
            
            const trendingTracks = tracksToShow.filter(track => ['Pop', 'Hip-Hop'].includes(track.genre));
            trendingTracks.slice(0, 6).forEach((track, index) => {
                setTimeout(() => {
                    const card = createTrackCard(track);
                    card.classList.add('fade-in');
                    trendingGrid.appendChild(card);
                }, (index + 6) * 100);
            });
            
            // Render all music
            const allMusicGrid = document.getElementById('all-music-grid');
            allMusicGrid.innerHTML = '';
            
            tracksToShow.slice(0, 12).forEach((track, index) => {
                setTimeout(() => {
                    const card = createTrackCard(track);
                    card.classList.add('fade-in');
                    allMusicGrid.appendChild(card);
                }, (index + 12) * 50);
            });
            
            // Update like buttons after rendering
            setTimeout(() => {
                updateLikeButtons();
            }, 1000);
        }

        function createTrackCard(track, isHalloween = false) {
            const card = document.createElement('div');
            card.className = `card ${isHalloween || track.isHalloween ? 'halloween-card' : ''}`;
            
            const gradients = [
                'linear-gradient(135deg, #ff6b35, #f7931e)',
                'linear-gradient(135deg, #667eea, #764ba2)',
                'linear-gradient(135deg, #f093fb, #f5576c)',
                'linear-gradient(135deg, #4facfe, #00f2fe)',
                'linear-gradient(135deg, #43e97b, #38f9d7)',
                'linear-gradient(135deg, #fa709a, #fee140)',
                'linear-gradient(135deg, #a8edea, #fed6e3)'
            ];
            
            const gradient = isHalloween || track.isHalloween ? 
                'linear-gradient(135deg, #ff6b35, #f7931e)' : 
                gradients[Math.floor(Math.random() * gradients.length)];
            
            const halloweenEmoji = track.isHalloween ? '<span class="halloween-emoji">🎃</span>' : '';
            
            card.innerHTML = `
                <div class="card-image" style="background: ${gradient};">
                    ${track.isHalloween ? '🎃' : '🎵'}
                    <button class="like-btn" data-track-id="${track.id}" onclick="event.stopPropagation(); toggleLike('${track.id}')">
                        🤍
                    </button>
                    <div class="play-overlay" onclick="playTrack('${track.id}')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                </div>
                <div class="card-title">${track.title}${halloweenEmoji}</div>
                <div class="card-subtitle">${track.artist} • ${track.genre}</div>
            `;
            
            return card;
        }

        function renderPlaylists() {
            const playlistList = document.getElementById('playlist-list');
            playlistList.innerHTML = '';
            
            playlists.forEach(playlist => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.innerHTML = `
                    <span>🎃 ${playlist.name}</span>
                    <button onclick="deletePlaylist('${playlist.id}')" style="background: none; border: none; color: #b3b3b3; cursor: pointer; padding: 4px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 6h18l-1.5 14H4.5L3 6zm5-4h8v2H8V2z"/>
                        </svg>
                    </button>
                `;
                item.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'svg' && e.target.tagName !== 'path') {
                        openPlaylist(playlist);
                    }
                };
                playlistList.appendChild(item);
            });
        }

        function renderLibrary() {
            const libraryContent = document.getElementById('library-content');
            libraryContent.innerHTML = '';
            
            if (playlists.length === 0) {
                libraryContent.innerHTML = `
                    <div style="text-align: center; padding: 48px; color: #b3b3b3;">
                        <h3>🎃 Create your first Halloween playlist</h3>
                        <p>Perfect for spooky season!</p>
                        <button class="btn btn-primary" onclick="openCreatePlaylistModal()" style="margin-top: 16px;">
                            🎃 Create Playlist
                        </button>
                    </div>
                `;
                return;
            }
            
            playlists.forEach(playlist => {
                const privacyIcon = playlist.privacy === 'public' ? '🌍' : '🔒';
                const privacyText = playlist.privacy === 'public' ? 'Public' : 'Private';
                
                const item = document.createElement('div');
                item.className = 'card';
                item.style.marginBottom = '16px';
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div class="card-image" style="width: 64px; height: 64px; margin-bottom: 0; background: linear-gradient(135deg, #ff6b35, #f7931e);">
                            🎃
                        </div>
                        <div style="flex: 1;">
                            <div class="card-title">${playlist.name} ${privacyIcon}</div>
                            <div class="card-subtitle">${playlist.description || 'Halloween Playlist'} • ${playlist.tracks?.length || 0} songs • ${privacyText}</div>
                        </div>
                        <button onclick="deletePlaylist('${playlist.id}')" class="btn btn-secondary" style="padding: 8px 16px;">
                            Delete
                        </button>
                    </div>
                `;
                libraryContent.appendChild(item);
            });
        }
        
        function renderFavorites() {
            const favoritesContent = document.getElementById('favorites-content');
            favoritesContent.innerHTML = '';
            
            if (likedTracks.length === 0) {
                favoritesContent.innerHTML = `
                    <div style="text-align: center; padding: 48px; color: #b3b3b3;">
                        <h3>❤️ No favorite songs yet</h3>
                        <p>Like songs by clicking the heart button to see them here!</p>
                        <button class="btn btn-primary" onclick="showView('home')" style="margin-top: 16px;">
                            🎵 Browse Music
                        </button>
                    </div>
                `;
                return;
            }
            
            const likedTracksData = sampleTracks.filter(track => likedTracks.includes(track.id));
            
            likedTracksData.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'card';
                item.style.marginBottom = '12px';
                
                const gradient = track.isHalloween ? 
                    'linear-gradient(135deg, #ff6b35, #f7931e)' : 
                    'linear-gradient(135deg, #667eea, #764ba2)';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div class="card-image" style="width: 48px; height: 48px; margin-bottom: 0; background: ${gradient};">
                            ${track.isHalloween ? '🎃' : '🎵'}
                        </div>
                        <div style="flex: 1;">
                            <div class="card-title">${track.title} ${track.isHalloween ? '🎃' : ''}</div>
                            <div class="card-subtitle">${track.artist} • ${track.album} • ${track.duration}</div>
                        </div>
                        <button onclick="toggleLike('${track.id}')" class="btn" style="background: linear-gradient(45deg, #ff6b35, #f7931e); color: white; padding: 8px 12px;">
                            ❤️ Unlike
                        </button>
                        <button onclick="playTrack('${track.id}')" class="btn btn-primary" style="padding: 8px 16px;">
                            ▶️ Play
                        </button>
                    </div>
                `;
                favoritesContent.appendChild(item);
            });
        }

        // YouTube Player Integration
        let youtubePlayer = null;
        let playerReady = false;

        // Load YouTube IFrame API
        function loadYouTubeAPI() {
            if (!window.YT) {
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
        }

        // YouTube API ready callback
        window.onYouTubeIframeAPIReady = function() {
            youtubePlayer = new YT.Player('youtube-player', {
                height: '0',
                width: '0',
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'fs': 0,
                    'modestbranding': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        };

        function onPlayerReady(event) {
            playerReady = true;
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayButton();
                startProgressTracking();
                document.getElementById('equalizer').style.display = 'flex';
            } else if (event.data === YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayButton();
                stopProgressTracking();
                document.getElementById('equalizer').style.display = 'none';
            } else if (event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
                updatePlayButton();
                currentTime = 0;
                updateProgressBar();
                document.getElementById('equalizer').style.display = 'none';
                
                // Handle auto-play based on loop/shuffle settings
                if (isLooping) {
                    // Replay current track
                    playTrack(currentTrack.id);
                } else if (isShuffling) {
                    // Play random track
                    const randomIndex = Math.floor(Math.random() * sampleTracks.length);
                    playTrack(sampleTracks[randomIndex].id);
                } else {
                    // Play next track in order
                    nextTrack();
                }
            }
        }

        let progressInterval;

        function startProgressTracking() {
            if (progressInterval) clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (youtubePlayer && playerReady && isPlaying) {
                    currentTime = Math.floor(youtubePlayer.getCurrentTime());
                    totalTime = Math.floor(youtubePlayer.getDuration());
                    updateProgressBar();
                }
            }, 1000);
        }

        function stopProgressTracking() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }

        function updatePlayButton() {
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            
            if (isPlaying) {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        }

        // Player Functions
        function playTrack(trackId) {
            // Check usage limit for free users
            if (!userProfile.isPremium && !startUsageTracking()) {
                return; // Usage limit reached
            }
            
            const track = sampleTracks.find(t => t.id === trackId);
            if (!track) return;
            
            currentTrack = track;
            currentTrackIndex = sampleTracks.findIndex(t => t.id === trackId);
            
            document.getElementById('current-track-name').textContent = track.title;
            document.getElementById('current-track-artist').textContent = track.artist;
            document.getElementById('total-time').textContent = track.duration;
            
            // Update current track image with Halloween theme
            const trackImage = document.getElementById('current-track-image');
            if (track.isHalloween) {
                trackImage.style.background = 'linear-gradient(135deg, #ff6b35, #f7931e)';
                trackImage.textContent = '🎃';
            } else {
                trackImage.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                trackImage.textContent = '🎵';
            }
            
            // If track has YouTube ID, play it
            if (track.youtubeId && youtubePlayer && playerReady) {
                youtubePlayer.loadVideoById(track.youtubeId);
                showToast(`🎵 Playing: ${track.title} ${track.isHalloween ? '🎃' : ''}`);
            } else if (track.youtubeId && !playerReady) {
                showToast('Player loading... Please try again in a moment.');
            } else {
                // Fallback to demo mode for tracks without YouTube IDs
                if (!isPlaying) {
                    togglePlayPause();
                }
                currentTime = 0;
                updateProgressBar();
                showToast(`Demo mode: ${track.title} (Add YouTube ID to play actual audio)`);
            }
        }

        function togglePlayPause() {
            if (currentTrack && currentTrack.youtubeId && youtubePlayer && playerReady) {
                // YouTube player control
                if (isPlaying) {
                    youtubePlayer.pauseVideo();
                } else {
                    youtubePlayer.playVideo();
                }
            } else {
                // Demo mode fallback
                isPlaying = !isPlaying;
                updatePlayButton();
                
                if (isPlaying) {
                    startProgressTracking();
                    document.getElementById('equalizer').style.display = 'flex';
                } else {
                    stopProgressTracking();
                    document.getElementById('equalizer').style.display = 'none';
                }
            }
        }

        function updateProgressBar() {
            if (isPlaying && currentTrack) {
                const progress = (currentTime / totalTime) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';
                document.getElementById('current-time').textContent = formatTime(currentTime);
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function seekTo(event) {
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            
            if (currentTrack && currentTrack.youtubeId && youtubePlayer && playerReady) {
                // YouTube player seek
                const seekTime = percentage * youtubePlayer.getDuration();
                youtubePlayer.seekTo(seekTime, true);
            } else {
                // Demo mode seek
                currentTime = Math.floor(percentage * totalTime);
                updateProgressBar();
            }
        }

        // Enhanced Player Functions
        function previousTrack() {
            if (isShuffling) {
                // Play random track
                const randomIndex = Math.floor(Math.random() * sampleTracks.length);
                playTrack(sampleTracks[randomIndex].id);
                showToast(`🔀 Random: ${sampleTracks[randomIndex].title}`);
            } else if (currentTrackIndex > 0) {
                currentTrackIndex--;
                playTrack(sampleTracks[currentTrackIndex].id);
                showToast(`⏮️ Previous: ${sampleTracks[currentTrackIndex].title}`);
            } else {
                // Loop to last track
                currentTrackIndex = sampleTracks.length - 1;
                playTrack(sampleTracks[currentTrackIndex].id);
                showToast(`⏮️ Previous: ${sampleTracks[currentTrackIndex].title}`);
            }
        }
        
        function nextTrack() {
            if (isShuffling) {
                // Play random track
                const randomIndex = Math.floor(Math.random() * sampleTracks.length);
                playTrack(sampleTracks[randomIndex].id);
                showToast(`🔀 Random: ${sampleTracks[randomIndex].title}`);
            } else if (currentTrackIndex < sampleTracks.length - 1) {
                currentTrackIndex++;
                playTrack(sampleTracks[currentTrackIndex].id);
                showToast(`⏭️ Next: ${sampleTracks[currentTrackIndex].title}`);
            } else {
                // Loop to first track
                currentTrackIndex = 0;
                playTrack(sampleTracks[currentTrackIndex].id);
                showToast(`⏭️ Next: ${sampleTracks[currentTrackIndex].title}`);
            }
        }

        // Search Functions
        function performSearch(query) {
            const searchResults = document.getElementById('search-results');
            const searchContent = document.getElementById('search-content');
            const browseSection = document.getElementById('browse-section');
            
            if (query.trim() === '') {
                searchResults.classList.add('hidden');
                browseSection.classList.remove('hidden');
                return;
            }
            
            searchResults.classList.remove('hidden');
            browseSection.classList.add('hidden');
            
            const results = sampleTracks.filter(track =>
                track.title.toLowerCase().includes(query.toLowerCase()) ||
                track.artist.toLowerCase().includes(query.toLowerCase()) ||
                track.album.toLowerCase().includes(query.toLowerCase()) ||
                track.genre.toLowerCase().includes(query.toLowerCase())
            );
            
            searchContent.innerHTML = '';
            
            if (results.length === 0) {
                searchContent.innerHTML = '<p style="color: #b3b3b3; text-align: center; padding: 32px;">No spooky results found 🎃</p>';
                return;
            }
            
            results.forEach(track => {
                const item = document.createElement('div');
                item.className = 'card';
                item.style.marginBottom = '12px';
                
                const gradient = track.isHalloween ? 
                    'linear-gradient(135deg, #ff6b35, #f7931e)' : 
                    'linear-gradient(135deg, #667eea, #764ba2)';
                
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div class="card-image" style="width: 48px; height: 48px; margin-bottom: 0; background: ${gradient};">
                            ${track.isHalloween ? '🎃' : '🎵'}
                        </div>
                        <div style="flex: 1;">
                            <div class="card-title">${track.title} ${track.isHalloween ? '🎃' : ''}</div>
                            <div class="card-subtitle">${track.artist} • ${track.album} • ${track.genre}</div>
                        </div>
                        <div style="color: #b3b3b3; font-size: 14px;">${track.duration}</div>
                        <button onclick="toggleLike('${track.id}')" class="btn" style="background: rgba(255, 107, 53, 0.2); color: #ff6b35; padding: 8px 12px; margin-right: 8px;">
                            🤍
                        </button>
                        <button onclick="playTrack('${track.id}')" class="btn btn-primary" style="padding: 8px 16px;">
                            Play
                        </button>
                    </div>
                `;
                searchContent.appendChild(item);
            });
            
            // Update like buttons in search results
            setTimeout(() => {
                updateLikeButtons();
            }, 100);
        }

        // Modal Functions
        function openCreatePlaylistModal() {
            document.getElementById('playlist-modal').classList.remove('hidden');
        }

        function closeCreatePlaylistModal() {
            document.getElementById('playlist-modal').classList.add('hidden');
            document.getElementById('playlist-form').reset();
        }

        async function handleCreatePlaylist(event) {
            event.preventDefault();
            
            const name = document.getElementById('playlist-name').value.trim();
            const description = document.getElementById('playlist-description').value.trim();
            const privacy = document.getElementById('playlist-privacy').value;
            
            if (!name) return;
            
            await createPlaylist(name, description, privacy);
            closeCreatePlaylistModal();
        }
        
        // Usage Tracking Functions
        function startUsageTracking() {
            if (userProfile.isPremium) return true; // Premium users have unlimited access
            
            // Reset daily usage if it's a new day
            const today = new Date().toDateString();
            if (userProfile.lastUsageReset !== today) {
                userProfile.dailyUsage = 0;
                userProfile.lastUsageReset = today;
                saveUserProfile();
            }
            
            // Check if user has exceeded daily limit
            if (userProfile.dailyUsage >= 240) { // 4 hours = 240 minutes
                showUsageLimitModal();
                return false;
            }
            
            usageStartTime = Date.now();
            usageInterval = setInterval(() => {
                if (usageStartTime) {
                    const currentUsage = Math.floor((Date.now() - usageStartTime) / 60000); // minutes
                    userProfile.dailyUsage += 1;
                    
                    updateUsageDisplay();
                    saveUserProfile();
                    
                    // Check if limit reached
                    if (userProfile.dailyUsage >= 240) {
                        showUsageLimitModal();
                        stopUsageTracking();
                    }
                }
            }, 60000); // Update every minute
            
            return true;
        }
        
        function stopUsageTracking() {
            if (usageInterval) {
                clearInterval(usageInterval);
                usageInterval = null;
            }
            usageStartTime = null;
        }
        
        function updateUsageDisplay() {
            const hours = Math.floor(userProfile.dailyUsage / 60);
            const minutes = userProfile.dailyUsage % 60;
            const usageText = `${hours}h ${minutes}m used today`;
            
            const usageElement = document.getElementById('usage-time');
            if (usageElement) {
                usageElement.textContent = usageText;
            }
            
            // Update account status
            const statusElement = document.getElementById('account-status');
            if (statusElement) {
                if (userProfile.isPremium) {
                    statusElement.textContent = 'Halloween Premium Plan - Unlimited spooky access 🎃';
                } else {
                    const remaining = 240 - userProfile.dailyUsage;
                    const remainingHours = Math.floor(remaining / 60);
                    const remainingMinutes = remaining % 60;
                    statusElement.textContent = `Free Plan - ${remainingHours}h ${remainingMinutes}m remaining today`;
                }
            }
        }
        
        function showUsageLimitModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="text-align: center;">
                    <h3 style="color: #ff6b35; margin-bottom: 16px;">🎃 Daily Limit Reached</h3>
                    <p style="margin-bottom: 24px; color: #b3b3b3;">You've used your 4-hour daily limit. Upgrade to Halloween Premium for unlimited spooky listening!</p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn btn-primary" onclick="openUpgradeModal(); this.parentElement.parentElement.parentElement.remove();">
                            🎃 Upgrade to Premium
                        </button>
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove();">
                            Try Tomorrow
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Pause any playing music
            if (isPlaying) {
                togglePlayPause();
            }
        }
        
        // Profile Management
        function saveUserProfile() {
            try {
                localStorage.setItem('soundify_profile', JSON.stringify(userProfile));
            } catch (error) {
                console.error('Error saving profile:', error);
            }
        }
        
        async function loadUserProfile() {
            try {
                const saved = localStorage.getItem('soundify_profile');
                if (saved) {
                    userProfile = { ...userProfile, ...JSON.parse(saved) };
                }
                
                // Check if user has premium access by email
                if (currentUser && currentUser.email) {
                    const hasPremium = await checkPremiumStatus(currentUser.email);
                    if (hasPremium && !userProfile.isPremium) {
                        userProfile.isPremium = true;
                        saveUserProfile();
                        showToast('🎃 Premium access detected for your account!');
                    }
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }
        
        // Modal Functions
        function openProfileModal() {
            document.getElementById('profile-name').value = userProfile.displayName;
            document.getElementById('profile-bio').value = userProfile.bio;
            document.getElementById('profile-genre').value = userProfile.favoriteGenre;
            updateUsageDisplay();
            document.getElementById('profile-modal').classList.remove('hidden');
        }
        
        function closeProfileModal() {
            document.getElementById('profile-modal').classList.add('hidden');
        }
        
        function openUpgradeModal() {
            // Show admin controls if user is admin
            const isAdmin = currentUser && adminEmails.includes(currentUser.email);
            const adminSection = document.getElementById('admin-upgrade-section');
            
            if (isAdmin) {
                adminSection.classList.remove('hidden');
            } else {
                adminSection.classList.add('hidden');
            }
            
            // Update button text based on premium status
            const upgradeBtn = document.getElementById('upgrade-action-btn');
            if (userProfile.isPremium) {
                upgradeBtn.textContent = '🎃 Already Premium ✓';
                upgradeBtn.disabled = true;
                upgradeBtn.style.opacity = '0.6';
            } else {
                upgradeBtn.textContent = '🎃 Upgrade Now';
                upgradeBtn.disabled = false;
                upgradeBtn.style.opacity = '1';
            }
            
            document.getElementById('upgrade-modal').classList.remove('hidden');
        }
        
        function closeUpgradeModal() {
            document.getElementById('upgrade-modal').classList.add('hidden');
        }
        
        // Premium Management (Admin Only)
        async function grantPremiumByEmail() {
            if (!currentUser || !adminEmails.includes(currentUser.email)) {
                showToast('❌ Access denied - Admin privileges required');
                return;
            }
            
            const email = document.getElementById('grant-email').value.trim();
            if (!email) {
                showToast('❌ Please enter a valid email address');
                return;
            }
            
            try {
                // Save to Firestore premium users collection
                await db.collection('premiumUsers').doc(email).set({
                    email: email,
                    isPremium: true,
                    grantedBy: currentUser.email,
                    grantedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showToast(`🎃 Premium access granted to ${email}`);
                document.getElementById('grant-email').value = '';
            } catch (error) {
                // Fallback to localStorage if Firestore fails
                const premiumUsers = JSON.parse(localStorage.getItem('soundify_premium_users') || '{}');
                premiumUsers[email] = {
                    isPremium: true,
                    grantedBy: currentUser.email,
                    grantedAt: new Date().toISOString()
                };
                localStorage.setItem('soundify_premium_users', JSON.stringify(premiumUsers));
                
                showToast(`🎃 Premium access granted to ${email} (saved locally)`);
                document.getElementById('grant-email').value = '';
            }
        }
        
        async function revokePremiumByEmail() {
            if (!currentUser || !adminEmails.includes(currentUser.email)) {
                showToast('❌ Access denied - Admin privileges required');
                return;
            }
            
            const email = document.getElementById('grant-email').value.trim();
            if (!email) {
                showToast('❌ Please enter a valid email address');
                return;
            }
            
            try {
                // Remove from Firestore
                await db.collection('premiumUsers').doc(email).delete();
                
                showToast(`⚠️ Premium access revoked from ${email}`);
                document.getElementById('grant-email').value = '';
            } catch (error) {
                // Fallback to localStorage
                const premiumUsers = JSON.parse(localStorage.getItem('soundify_premium_users') || '{}');
                delete premiumUsers[email];
                localStorage.setItem('soundify_premium_users', JSON.stringify(premiumUsers));
                
                showToast(`⚠️ Premium access revoked from ${email} (removed locally)`);
                document.getElementById('grant-email').value = '';
            }
        }
        
        // Check if user has premium access by email
        async function checkPremiumStatus(userEmail) {
            try {
                // Check Firestore first
                const doc = await db.collection('premiumUsers').doc(userEmail).get();
                if (doc.exists && doc.data().isPremium) {
                    return true;
                }
            } catch (error) {
                console.log('Firestore check failed, checking localStorage');
            }
            
            // Fallback to localStorage
            const premiumUsers = JSON.parse(localStorage.getItem('soundify_premium_users') || '{}');
            return premiumUsers[userEmail]?.isPremium || false;
        }
        
        function upgradeToPremium() {
            if (userProfile.isPremium) {
                showToast('🎃 You already have Halloween Premium access!');
                return;
            }
            
            // In a real app, this would integrate with payment processing
            showToast('💳 Payment processing not implemented in demo. Contact admin for Premium access.');
        }
        
        function updateUpgradeButton() {
            const upgradeText = document.getElementById('upgrade-text');
            if (userProfile.isPremium) {
                upgradeText.textContent = '🎃 Premium ✓';
                upgradeText.parentElement.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
            } else {
                upgradeText.textContent = 'Upgrade';
                upgradeText.parentElement.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
            }
        }
        
        // Profile Form Handler
        async function handleProfileUpdate(event) {
            event.preventDefault();
            
            userProfile.displayName = document.getElementById('profile-name').value.trim();
            userProfile.bio = document.getElementById('profile-bio').value.trim();
            userProfile.favoriteGenre = document.getElementById('profile-genre').value;
            
            saveUserProfile();
            closeProfileModal();
            showToast('🎃 Profile updated successfully!');
        }

        function updateStats() {
            document.getElementById('total-tracks').textContent = sampleTracks.length;
            document.getElementById('total-playlists').textContent = playlists.length;
            document.getElementById('liked-count').textContent = likedTracks.length;
            document.getElementById('listening-time').textContent = Math.floor(listeningTime / 60) + 'h';
        }

        // Utility Functions
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Configuration management (without Element SDK)
        function updateAppConfig() {
            const logoText = document.querySelector('#app-logo .logo-text');
            const authTitleText = document.querySelector('#auth-title span');
            
            if (logoText) logoText.textContent = defaultConfig.app_name;
            if (authTitleText) authTitleText.textContent = defaultConfig.app_name;
            document.getElementById('welcome-title').textContent = defaultConfig.welcome_message;
        }

        // Update Log Functions
        function toggleUpdateLog() {
            updateLogVisible = !updateLogVisible;
            const logPanel = document.getElementById('update-log');
            
            if (updateLogVisible) {
                logPanel.classList.add('show');
                renderUpdateLog();
            } else {
                logPanel.classList.remove('show');
            }
        }
        
        function renderUpdateLog() {
            const logEntries = document.getElementById('log-entries');
            logEntries.innerHTML = '';
            
            updateLog.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${entry.type}`;
                logEntry.innerHTML = `
                    <div class="log-date">${entry.date}</div>
                    <div class="log-action">${entry.action}</div>
                    <div class="log-description">${entry.description}</div>
                `;
                logEntries.appendChild(logEntry);
            });
        }
        
        function addUpdateLogEntry(action, type, description) {
            const newEntry = {
                date: new Date().toLocaleDateString(),
                action: action,
                type: type,
                description: description
            };
            updateLog.unshift(newEntry);
            
            if (updateLogVisible) {
                renderUpdateLog();
            }
        }
        
        function updateOnlineCount() {
            const min = 13;
            const max = 89;
            const count = Math.floor(Math.random() * (max - min + 1)) + min;
            document.getElementById('online-count').textContent = count;
        }

        // Event Listeners
        document.getElementById('auth-form').addEventListener('submit', handleAuth);
        document.getElementById('auth-toggle-link').addEventListener('click', toggleAuthMode);
        document.getElementById('playlist-form').addEventListener('submit', handleCreatePlaylist);
        document.getElementById('profile-form').addEventListener('submit', handleProfileUpdate);

        // Progress update interval
        setInterval(() => {
            if (isPlaying && currentTrack) {
                currentTime += 1;
                if (currentTime >= totalTime) {
                    if (isLooping) {
                        currentTime = 0; // Loop current track
                    } else {
                        currentTime = 0;
                        // Auto-play next track or shuffle
                        setTimeout(() => {
                            if (isShuffling) {
                                const randomIndex = Math.floor(Math.random() * sampleTracks.length);
                                playTrack(sampleTracks[randomIndex].id);
                            } else {
                                nextTrack();
                            }
                        }, 1000);
                    }
                }
                updateProgressBar();
            }
        }, 1000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize configuration
            updateAppConfig();
            loadYouTubeAPI();
            loadUserProfile();
            loadLikedTracks();
            updateStats();
            
            // Update online count every 30 seconds
            updateOnlineCount();
            setInterval(updateOnlineCount, 30000);
            
            // Add Google sign-in event listener
            document.getElementById('google-signin-btn').addEventListener('click', signInWithGoogle);
            
            // Auto-show update log on first visit with slide animation
            setTimeout(() => {
                if (!updateLogVisible) {
                    toggleUpdateLog();
                    document.getElementById('update-log').classList.add('slide-up');
                    setTimeout(() => toggleUpdateLog(), 8000); // Auto-close after 8 seconds
                }
            }, 2000);
            
            // Show Halloween welcome message
            const welcomeMsg = userProfile.isPremium ? 
                '🎃 Welcome to Soundify Halloween Premium! Unlimited spooky music awaits.' : 
                '🎃 Welcome to Soundify Halloween Edition! 50+ tracks of spooky fun await you.';
            showToast(welcomeMsg);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'997ac66db5bc614f',t:'MTc2MTk5MzYzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
